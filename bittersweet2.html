<!DOCTYPE html>
<html>
  <head>
    <title>My experiment</title>
    <script src="jspsych-6.0.1/jspsych.js"></script>
    <script src="jspsych-6.0.1/plugins/jspsych-html-keyboard-response.js"></script>
	<script src="jspsych-6.0.1/plugins/jspsych-html-slider-response.js"></script>
	<script src="jspsych-6.0.1/plugins/jspsych-image-slider-response.js"></script>
	<script src="jspsych-6.0.1/plugins/jspsych-fullscreen.js"></script>
	<script src="jspsych-6.0.2/plugins/jspsych-survey-text.js"></script>
    <link href="jspsych-6.0.1/css/jspsych.css" rel="stylesheet" type="text/css"></link>
  </head>
  <body></body>
  <script>

 
	  /*create timeline */
	  var timeline = [];
	  
	  /*define welcome message trial */
	  var welcome = {
		  type: "html-keyboard-response",
		  stimulus: "Welcome to the experiment. Press any key to begin."
	  };

	  timeline.push(welcome);
	  
/* enter fullscreen mode */
timeline.push({
  type: 'fullscreen',
  fullscreen_mode: true
});

/*instructions*/
	  var instructions = {
  		type: "html-keyboard-response",
  		stimulus: "<p>In the following exercise, you will listen to several " +
		 "short melodies. There are 14 melodies in total." +
		 " After each melody, you will rate the melody on a few adjectives."+
		  " You will also be asked how much you like the melody." +
		 " When you are ready to begin, please press spacebar to advance to the next screen.",
		  choices: [' '],
		  post_trial_gap: 250
						};
						
		timeline.push(instructions);

/* define sound array */		
		  var sounds = [
		  {minor_100:'melody/1_1.mp3', minor_7:'melody/1_2.mp3', minor_75:'melody/1_3.mp3', minor_50: 'melody/1_4.mp3', minor_25: 'melody/1_5.mp3', minor_0: 'melody/1_6.mp3', major_7: 'melody/1_7.mp3', name: "Melody 1"},
		  {minor_100:'melody/2_1.mp3', minor_7:'melody/2_2.mp3', minor_75:'melody/2_3.mp3', minor_50: 'melody/2_4.mp3', minor_25: 'melody/2_5.mp3', minor_0: 'melody/2_6.mp3', major_7: 'melody/2_7.mp3', name: "Melody 2"},
		  {minor_100:'melody/3_1.mp3', minor_7:'melody/3_2.mp3', minor_75:'melody/3_3.mp3', minor_50: 'melody/3_4.mp3', minor_25: 'melody/3_5.mp3', minor_0: 'melody/3_6.mp3', major_7: 'melody/3_7.mp3', name: "Melody 3"},
		  {minor_100:'melody/4_1.mp3', minor_7:'melody/4_2.mp3', minor_75:'melody/4_3.mp3', minor_50: 'melody/4_4.mp3', minor_25: 'melody/4_5.mp3', minor_0: 'melody/4_6.mp3', major_7: 'melody/4_7.mp3', name: "Melody 4"},
		  {minor_100:'melody/5_1.mp3', minor_7:'melody/5_2.mp3', minor_75:'melody/5_3.mp3', minor_50: 'melody/5_4.mp3', minor_25: 'melody/5_5.mp3', minor_0: 'melody/5_6.mp3', major_7: 'melody/5_7.mp3', name: "Melody 5"},
		  {minor_100:'melody/6_1.mp3', minor_7:'melody/6_2.mp3', minor_75:'melody/6_3.mp3', minor_50: 'melody/6_4.mp3', minor_25: 'melody/6_5.mp3', minor_0: 'melody/6_6.mp3', major_7: 'melody/6_7.mp3', name: "Melody 6"},
		  {minor_100:'melody/7_1.mp3', minor_7:'melody/7_2.mp3', minor_75:'melody/7_3.mp3', minor_50: 'melody/7_4.mp3', minor_25: 'melody/7_5.mp3', minor_0: 'melody/7_6.mp3', major_7: 'melody/7_7.mp3', name: "Melody 7"},
		  ];
		  
/* randomize and split that array */			  
		  var soundsrandom = jsPsych.randomization.repeat(sounds, 1);

		  var sounds1 = soundsrandom.slice(0, 1);
		  var sounds2 = soundsrandom.slice(1, 2);
		  var sounds3 = soundsrandom.slice(2, 3);
		  var sounds4 = soundsrandom.slice(3, 4);
		  var sounds5 = soundsrandom.slice(4, 5);
		  var sounds6 = soundsrandom.slice(5, 6);
		  var sounds7 = soundsrandom.slice(6, 7);
		

/* define rating term array */			
		var terms = [
		{stimulus: 'melody/nostalgia.jpg'},
		{stimulus: 'melody/joy.jpg'},
		{stimulus: 'melody/sorrow.jpg'},
		{stimulus: 'melody/bittersweet.jpg'}
		];


/* randomize that array for the number of melodies */		
var termsrandom1 = jsPsych.randomization.repeat(terms, 1);	
var termsrandom2 = jsPsych.randomization.repeat(terms, 1);	
var termsrandom3 = jsPsych.randomization.repeat(terms, 1);	
var termsrandom4 = jsPsych.randomization.repeat(terms, 1);	
var termsrandom5 = jsPsych.randomization.repeat(terms, 1);	
var termsrandom6 = jsPsych.randomization.repeat(terms, 1);	
var termsrandom7 = jsPsych.randomization.repeat(terms, 1);		
		


/* define the music presentation trials */		
var minor_100 = {
	type: "html-keyboard-response",
	stimulus: jsPsych.timelineVariable('minor_100'),
	choices: jsPsych.NO_KEYS,
	trial_duration: 1000,
	timeline_variables: sounds1
       };
			  
 var minor_7 = {
 	type: "html-keyboard-response",
	stimulus: jsPsych.timelineVariable('minor_7'),
	choices: jsPsych.NO_KEYS,
	trial_duration: 1000,
	timeline_variables: sounds2
		};
				  
var minor_75 = {
	type: "html-keyboard-response",
	stimulus: jsPsych.timelineVariable('minor_75'),
	choices: jsPsych.NO_KEYS,
	trial_duration: 1000,
	timeline_variables: sounds3
	   		};  
			
var minor_50 = {
	type: "html-keyboard-response",
	stimulus: jsPsych.timelineVariable('minor_50'),
	choices: jsPsych.NO_KEYS,
	trial_duration: 1000,
	timeline_variables: sounds4
		   	};

var minor_25 = {
	type: "html-keyboard-response",
	stimulus: jsPsych.timelineVariable('minor_25'),
	choices: jsPsych.NO_KEYS,
	trial_duration: 1000,
	timeline_variables: sounds5
			};
			
var minor_0 = {
	type: "html-keyboard-response",
	stimulus: jsPsych.timelineVariable('minor_0'),
	choices: jsPsych.NO_KEYS,
	trial_duration: 1000,
	timeline_variables: sounds6
			};

var major_7 = {
	type: "html-keyboard-response",
	stimulus: jsPsych.timelineVariable('major_7'),
	choices: jsPsych.NO_KEYS,
	trial_duration: 1000,
	timeline_variables: sounds7
			};


/* Define Rating Trials */

var emo1 = {
	type: "image-slider-response",
	prompt: "<p>To what extent was the melody</p>",
	stimulus: jsPsych.timelineVariable('stimulus'),
	timeline: termsrandom1,
	labels: ['not at all', 'a great deal'],
	response_ends_trial: true
				};

var emo2 = {
	type: "image-slider-response",
	prompt: "<p>To what extent was the melody</p>",
	stimulus: jsPsych.timelineVariable('stimulus'),
	timeline: termsrandom2,
	labels: ['not at all', 'a great deal'],
	response_ends_trial: true
				};				
				
var emo3 = {
	type: "image-slider-response",
	prompt: "<p>To what extent was the melody</p>",
	stimulus: jsPsych.timelineVariable('stimulus'),
	timeline: termsrandom3,
	labels: ['not at all', 'a great deal'],
	response_ends_trial: true
				};
				
var emo4 = {
	type: "image-slider-response",
	prompt: "<p>To what extent was the melody</p>",
	stimulus: jsPsych.timelineVariable('stimulus'),
	timeline: termsrandom4,
	labels: ['not at all', 'a great deal'],
	response_ends_trial: true
				};

var emo5 = {
	type: "image-slider-response",
	prompt: "<p>To what extent was the melody</p>",
	stimulus: jsPsych.timelineVariable('stimulus'),
	timeline: termsrandom5,
	labels: ['not at all', 'a great deal'],
	response_ends_trial: true
				};
				
var emo6 = {
	type: "image-slider-response",
	prompt: "<p>To what extent was the melody</p>",
	stimulus: jsPsych.timelineVariable('stimulus'),
	timeline: termsrandom6,
	labels: ['not at all', 'a great deal'],
	response_ends_trial: true
				};

var emo7 = {
	type: "image-slider-response",
	prompt: "<p>To what extent was the melody</p>",
	stimulus: jsPsych.timelineVariable('stimulus'),
	timeline: termsrandom7,
	labels: ['not at all', 'a great deal'],
	response_ends_trial: true
				};
				
/* define liking trial separately (always comes at the end of the procedure */

var liking = {
	type: "html-slider-response",
	stimulus: '',
	prompt: "<p>How much did you <em>like</em> the melody?</p>",
	labels: ['not at all', 'a great deal'],
	response_ends_trial: true,
	data: {term: 'liking'}
				};
	
		
/* ****************************************************** */				
/* define the procedures for the different harmonizations */
/* ****************************************************** */		
	


/*****************************************************/
				 
var ratings1 = {
		timeline: [emo1, liking],
		timeline_variables: termsrandom1
			    };

var ratings2 = {
		timeline: [emo2, liking],
		timeline_variables: termsrandom2
			    };				

var ratings3 = {
		timeline: [emo3, liking],
		timeline_variables: termsrandom3
			    };					

var ratings4 = {
		timeline: [emo4, liking],
		timeline_variables: termsrandom4
			    };	

var ratings5 = {
		timeline: [emo5, liking],
		timeline_variables: termsrandom5
			    };
	
var ratings6 = {
		timeline: [emo6, liking],
		timeline_variables: termsrandom6
			    };

var ratings7 = {
		timeline: [emo7, liking],
		timeline_variables: termsrandom7
			    };


/*******************************************************/




				
var procedure_minor_100	= {
		timeline: [minor_100, ratings1]
		};

				
var procedure_minor_7 = {
		timeline: [minor_7, ratings2]
				 };
				 
var procedure_minor_75 = {
		timeline: [minor_75, ratings3]
				};
						
var procedure_minor_50 = {
		timeline: [minor_50, ratings4]

				 };
				 
var procedure_minor_25 = {
		timeline: [minor_25, ratings5]
				 };
				 
var procedure_minor_0 = {
		timeline: [minor_0, ratings6]
				 };
				 
var procedure_major_7 = {
		timeline: [major_7, ratings7]
				 };		
		
		
		
		
		
/* put all procedures together and shuffle them */				 
var trials = [
				 				procedure_minor_100,
				 				procedure_minor_7,
				 				procedure_minor_75,
				 				procedure_minor_50,
				 				procedure_minor_25,
				 				procedure_minor_0,
								procedure_major_7];
	
	
	
var shuffled_trials = jsPsych.randomization.shuffle(trials);
	
var block_structure = {
		timeline: shuffled_trials
		};	

timeline.push(block_structure);

/* ************************************************ */	
/* Basic Musical Experience / Demographic Questions */
/* ************************************************ */	

var interim = {
  type: "html-keyboard-response",
  stimulus: "Thank you for your responses. Press any key to continue."
};

timeline.push(interim);


var qD = {
  type: 'survey-text',
  questions: [{prompt: "How old are you (in years)?"}, {prompt: "What is your gender?"} ],
  preamble: ['Please answer the following questions to the best of your ability.']
};

timeline.push(qD);


var qM = {
  type: 'survey-text',
  questions: [{prompt: 'Have you ever played a musical instrument, including vocal training? (Y/N)'}, 
			  {prompt: 'How many years have you played your primary instrument? If you do not play an instrument / have voice training, please type 0.'}, 
			  {prompt: 'At what age (in years) did you first begin musical instruction? If you do not have any musical instruction, you may leave this question blank.'} 
			  ],
  preamble: ['Please answer the following questions to the best of your ability.'] 
};

timeline.push(qM);


/** exit fullscreen **/
timeline.push({
  type: 'fullscreen',
  fullscreen_mode: false
});



/*start experiment */ 
	  jsPsych.init ({
		  timeline: timeline,
		  on_finish: function() {jsPsych.data.get().localSave('csv','mydata.csv')}
		  //preload_audio: audio

	  })
	  </script>
	  



</html>