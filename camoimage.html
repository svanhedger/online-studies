<!DOCTYPE html>
<html>
  <head>
    <title>Image Identification</title>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
    <script src="jspsych-4.3/jspsych.js"></script>
    <script src="jspsych-4.3/plugins/jspsych-text.js"></script>
    <script src="jspsych-4.3/plugins/jspsych-single-audio.js"></script>
    <script src="jspsych-4.3/plugins/jspsych-single-stim.js"></script>
    <script src="jspsych-4.3/plugins/jspsych-multi-stim-multi-response.js"></script>
    <script src="jspsych-4.3/plugins/jspsych-survey-text.js"></script>
    <link href="jspsych-4.3/css/jspsych.css" rel="stylesheet" type="text/css">
	
	<style>
  body {
    color: black;
    background: gray;
  }
    </style>
	
	
  </head>
  <body>
    <script>
      var userip;
    </script>
    <script type="text/javascript" src="https://l2.io/ip.js?var=userip"></script>
    <script>
      var i;
      var subjectID;
      var folder = "camo/";
      
      var timestamp = Date.now();
      if (userip) {
        userip = userip.replace(/:/g, ".");
        subjectID = userip + "-" + timestamp;
      } else {
        subjectID = timestamp;
      }
      jsPsych.data.addProperties({subject: subjectID});
      
      var experiment = [];
      
      var consent = {
        type: "single-stim",
        stimuli: [folder + "consent.png"],
        prompt: '<p><p style="font-weight:bold;"> Please wait for the consent form to load. If you agree, please press any key to continue on to the study.</p>',
        timing_post_trial: 1000
      };
      
      experiment.push(consent);
      
      
      var welcome = {
        type: "text",
        text: '<p><p style="font-weight:bold;">Welcome to the experiment.</p>' +
              '<p><p style="font-weight:bold;">You will be presented with 80 images. These images depict a variety of familiar objects.</p>' +
              '<p><p style="font-weight:bold;">However, these images have been distorted, making them particularly difficult to identify. Your job is to make your best guess as to what each image contains.<p>' +
              '<p><p style="font-weight:bold;">To see an example image, press any key.</p>',
        timing_post_trial: 0
      };
      
      experiment.push(welcome);
      
      var example1 = {
	    type: "single-stim",
        stimuli: [folder + "Example1.jpg"],
        prompt: '<p><p style="font-weight:bold;">This image is similar to the ones you will be identifying. As you can see, it is quite difficult to make out.</p>' +
		'<p><p style="font-weight:bold;">Press any key to continue.</p>',
	  }
      
	  experiment.push(example1);
      
	  var example2 = {
	    type: "single-stim",
        stimuli: [folder + "Example2.jpg"],
        prompt: '<p><p style="font-weight:bold;">When comparing the distorted image to the original image, the object of the picture becomes clearer.</p>' +
		'<p><p style="font-weight:bold;">In the main task, you will not be shown the original images. You will have to make your decision based on the distorted image alone.</p>' +
		'<p><p style="font-weight:bold;">(Press any key to begin).</p>',
	  }
  
      experiment.push(example2);
  
 var img_stimuli = [
'<img src="camo/c_accordion2_7.bmp"></img>',
'<img src="camo/c_anchor2_10.bmp"></img>',
'<img src="camo/c_barn1_10.bmp"></img>',
'<img src="camo/c_barrel1_10.bmp"></img>',
'<img src="camo/c_bear1_7.bmp"></img>',
'<img src="camo/c_bench2_10.bmp"></img>',
'<img src="camo/c_bike2_8.bmp"></img>',
'<img src="camo/c_binoculars2_10.bmp"></img>',
'<img src="camo/c_bird7_3.bmp"></img>',
'<img src="camo/c_bison1_10.bmp"></img>',
'<img src="camo/c_blender1_10.bmp"></img>',
'<img src="camo/c_boat2_10.bmp"></img>',
'<img src="camo/c_butterfly2_10.bmp"></img>',
'<img src="camo/c_cake1_4.bmp"></img>',
'<img src="camo/c_campingtent1_4.bmp"></img>',
'<img src="camo/c_cat4_7.bmp"></img>',
'<img src="camo/c_chair1_10.bmp"></img>',
'<img src="camo/c_chandelier2_10.bmp"></img>',
'<img src="camo/c_cheetah3_10.bmp"></img>',
'<img src="camo/c_computermouse1_7.bmp"></img>',
'<img src="camo/c_controller2_10.bmp"></img>',
'<img src="camo/c_couch2_10.bmp"></img>',
'<img src="camo/c_cow2_8.bmp"></img>',
'<img src="camo/c_dalmatian2_5.bmp"></img>',
'<img src="camo/c_deer1_10.bmp"></img>',
'<img src="camo/c_dog4_10.bmp"></img>',
'<img src="camo/c_dolphin1_4.bmp"></img>',
'<img src="camo/c_dragonfly1_8.bmp"></img>',
'<img src="camo/c_duck2_10.bmp"></img>',
'<img src="camo/c_dumbells1_10.bmp"></img>',
'<img src="camo/c_elephant1_10.bmp"></img>',
'<img src="camo/c_escalator1_10.bmp"></img>',
'<img src="camo/c_fan2_10.bmp"></img>',
'<img src="camo/c_fish2_10.bmp"></img>',
'<img src="camo/c_flamingo1_2.bmp"></img>',
'<img src="camo/c_gator2_10.bmp"></img>',
'<img src="camo/c_giraffe1_10.bmp"></img>',
'<img src="camo/c_glasses2_10.bmp"></img>',
'<img src="camo/c_hedgehog1_10.bmp"></img>',
'<img src="camo/c_helicopter1_10.bmp"></img>',
'<img src="camo/c_iron6_5.bmp"></img>',
'<img src="camo/c_koala2_10.bmp"></img>',
'<img src="camo/c_lamp3_5.bmp"></img>',
'<img src="camo/c_llama1_10.bmp"></img>',
'<img src="camo/c_matchbook1_5.bmp"></img>',
'<img src="camo/c_mixer2_5.bmp"></img>',
'<img src="camo/c_motorcycle3_5.bmp"></img>',
'<img src="camo/c_octopus1_10.bmp"></img>',
'<img src="camo/c_orangutan1_10.bmp"></img>',
'<img src="camo/c_oven1_2.bmp"></img>',
'<img src="camo/c_owl1_10.bmp"></img>',
'<img src="camo/c_panda2_4.bmp"></img>',
'<img src="camo/c_penguin2_10.bmp"></img>',
'<img src="camo/c_piano1_4.bmp"></img>',
'<img src="camo/c_pig1_10.bmp"></img>',
'<img src="camo/c_rabbit2_10.bmp"></img>',
'<img src="camo/c_racoon1_10.bmp"></img>',
'<img src="camo/c_rhino1_8.bmp"></img>',
'<img src="camo/c_rooster1_4.bmp"></img>',
'<img src="camo/c_saxaphone3_1.bmp"></img>',
'<img src="camo/c_scale1_10.bmp"></img>',
'<img src="camo/c_scorpion1_10.bmp"></img>',
'<img src="camo/c_shark2_4.bmp"></img>',
'<img src="camo/c_skateboard_10.bmp"></img>',
'<img src="camo/c_slide1_10.bmp"></img>',
'<img src="camo/c_snail1_3.bmp"></img>',
'<img src="camo/c_snake1_10.bmp"></img>',
'<img src="camo/c_sneakers3_5.bmp"></img>',
'<img src="camo/c_squirrel1_10.bmp"></img>',
'<img src="camo/c_stapler2_10.bmp"></img>',
'<img src="camo/c_swan1_5.bmp"></img>',
'<img src="camo/c_swing1_10.bmp"></img>',
'<img src="camo/c_teapot1_10.bmp"></img>',
'<img src="camo/c_train1_10.bmp"></img>',
'<img src="camo/c_turtle6_8.bmp"></img>',
'<img src="camo/c_walrus3_4.bmp"></img>',
'<img src="camo/c_watch1_10.bmp"></img>',
'<img src="camo/c_waterfountain2_10.bmp"></img>',
'<img src="camo/c_wolf2_8.bmp"></img>',
'<img src="camo/c_workoutroom1_10.bmp"></img>'
 ]
  
    var rand_img_trials = jsPsych.randomization.repeat(img_stimuli,1);
      
    for(var i=0; i < rand_img_trials.length; i++){
	
	    var fixation = {
        type: "multi-stim-multi-response",
        stimuli: [["***", "**", "*"]],
        is_html: true,
        timing_stim: [500, 500, 500],
        timing_response: 1500,
        choices: [null, null, null],
        response_ends_trial: false,
        timing_post_trial: 0
      };

      var response = {
          type: "survey-text",
		  preamble: [rand_img_trials[i]],
          questions: [[
          '<p style="font-weight:bold;">In a few words, please tell us what you think what this image contains. If you are not sure, please make your best guess.',
        ]],
          timing_post_trial: 0
        };
        
        experiment.push(fixation);
        experiment.push(response);
      }
      
      var questionnaire = {
        type: "survey-text",
        preamble: ['<p style="font-weight:bold;">The following is a questionnaire to gauge basic demographic information.'],
        questions: [[
          'What is your gender? If you prefer not to answer, please type "prefer not to answer."',
		  'What is your age (in years)?',
          'Do you have any comments, questions, or suggestions regarding this study?'
        ]],
        on_finish: function () {
          var csvData = jsPsych.data.dataAsCSV();
          console.log(csvData);
          var formData = {
            exp: "CAMO1",  // comment out for testing
            // exp: "TEST",  // uncomment for testing
            subj: subjectID,
            results: csvData
          };
          $.post(
            "http://perfectpitchstudies.pythonanywhere.com/data",
            formData
          );
		  $.post(
            "http://svanhedger.pythonanywhere.com/data",
            formData
          );
        }
      };
      
      experiment.push(questionnaire);
      
      var goodbye = {
        type: "single-stim",
        stimuli: function () {
          var pageText = '<p><p style="font-weight:bold;">This concludes the experiment. Thank you for your participation.</p>' +
                         '<p>Below is your subject ID. Please copy it.</p>' +
                         '<p>' + subjectID + '</p>';
          return [pageText];
        },
        is_html: true,
        response_ends_trial: false,
        timing_post_trial: 0
      };
      
      experiment.push(goodbye);
      
      jsPsych.init({
        experiment_structure: experiment
      });
    </script>
  </body>
</html>
