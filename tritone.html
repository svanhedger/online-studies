<!DOCTYPE html>
<html>
  <head>
    <title>Tritone Study</title>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
    <script src="jspsych-4.3/jspsych.js"></script>
    <script src="jspsych-4.3/plugins/jspsych-text.js"></script>
    <script src="jspsych-4.3/plugins/jspsych-single-audio.js"></script>
    <script src="jspsych-4.3/plugins/jspsych-single-stim.js"></script>
    <script src="jspsych-4.3/plugins/jspsych-survey-text.js"></script>
    <link href="jspsych-4.3/css/jspsych.css" rel="stylesheet" type="text/css">
    <style>#blah {display: none;}</style>


  </head>
  <body>
    <script>
	 var userip;
    </script>
    <script type="text/javascript" src="https://l2.io/ip.js?var=userip"></script>
    <script>
	
      var subjectID;
      
      var timestamp = Date.now();
      if (userip) {
        userip = userip.replace(/:/g, ".");
        subjectID = userip + "-" + timestamp;
      } else {
        subjectID = timestamp;
      }
      jsPsych.data.addProperties({subject: subjectID});
      
      
      var experiment = [];
      
      var musics = ['C1', 'C2', 'C3', 'Cs1', 'Cs2', 'Cs3', 'D1', 'D2', 'D3', 'Ds1', 'Ds2', 'Ds3', 'E1', 'E2', 'E3', 'F1', 'F2', 'F3', 'Fs1', 'Fs2', 'Fs3', 'G1', 'G2', 'G3', 'Gs1', 'Gs2', 'Gs3', 'A1', 'A2', 'A3', 'As1', 'As2', 'As3', 'B1', 'B2', 'B3'];
      var musicStimuli = [];
      for (var i = 0; i < 36; i += 1) {
        musicStimuli.push('music/' + encodeURIComponent(musics[i] + '.mp3'));
      }
      

      var totalCorrect = 0;
      var totalCorrectC = 0;
      var totalCorrectCs = 0;
      var totalCorrectD = 0;
      var totalCorrectDs = 0;
      var totalCorrectE = 0;
      var totalCorrectF = 0;
      var totalCorrectFs = 0;
      var totalCorrectG = 0;
      var totalCorrectGs = 0;
      var totalCorrectA = 0;
      var totalCorrectAs = 0;
      var totalCorrectB = 0;
      
      var totalCorrect2 = 0;
      var totalCorrectC2 = 0;
      var totalCorrectCs2 = 0;
      var totalCorrectD2 = 0;
      var totalCorrectDs2 = 0;
      var totalCorrectE2 = 0;
      var totalCorrectF2 = 0;
      var totalCorrectFs2 = 0;
      var totalCorrectG2 = 0;
      var totalCorrectGs2 = 0;
      var totalCorrectA2 = 0;
      var totalCorrectAs2 = 0;
      var totalCorrectB2 = 0;
      
	  
	  var consent = {
        type: "single-stim",
        stimuli: ['music/consent.PNG'],
        prompt: '<p>Please wait for the consent form to load. If you agree, please press any key to continue on to the study.</p>',
        timing_post_trial: 1000
      };
      
      experiment.push(consent);
     
	 
	   var volumeTest = {
        type: "single-audio",
        stimuli: ['music/volumetest.wav'],
        timing_response: 10000,
        response_ends_trial: false,
        prompt: "<p>Before we begin, please adjust your volume so that the sound currently being played is at a comfortable listening level.</p>",
        timing_post_trial: 0
      };
      
      experiment.push(volumeTest);
	 
      var welcome = {
        type: "text",
        text: "<p>Welcome to the experiment. This will take 30 to 40 minutes to complete.</p>" +
          "<p>For the first portion of the experiment, on each trial you will hear a two musical notes, one after the other.</p>" +
		  "<p>Your task is to judge whether you the notes are descending (going from high to low) or ascending (going from low to high).</p>" +
          "<p>Press any key to begin.</p>",
        timing_post_trial: 2000
      };
      
      experiment.push(welcome);
      
      var notes = ['C', 'Cs', 'D', 'Ds', 'E', 'F', 'Fs', 'G', 'Gs', 'A', 'As', 'B'];
      var stimuli = [];
      for (var i = 0; i < 12; i += 1) {
        stimuli.push('music/' + encodeURIComponent(notes[i] + '.wav'));
      }
      
      var block1Stimuli = jsPsych.randomization.repeat(stimuli, 5);
      var block2Stimuli = jsPsych.randomization.repeat(stimuli, 5);
      
/* Define "correctness" as descending, and define the note names as categories for data*/
      
      var blocklength = block1Stimuli.length;

      
      for (var i = 0; i < blocklength; i += 1) {
        var stimulus1 = block1Stimuli[i];
        var startNote;

        var block1trial = {
          type: "single-audio",
          stimuli: [stimulus1],
          timing_response: 1150,
          response_ends_trial: false,
          timing_post_trial: 0
        };
        
        var filePath = decodeURIComponent(stimulus1);
        var correctKeyPress = 49;
        if (filePath.indexOf("/C.") > -1) {
          startNote = "C";
        } else if (filePath.indexOf("/Cs.") > -1) {
          startNote = "C#";
        } else if (filePath.indexOf("/D.") > -1) {
          startNote = "D";
        } else if (filePath.indexOf("/Ds.") > -1) {
          startNote = "D#";
        } else if (filePath.indexOf("/E.") > -1) {
          startNote = "E";
        } else if (filePath.indexOf("/F.") > -1) {
          startNote = "F";
        } else if (filePath.indexOf("/Fs.") > -1) {
          startNote = "F#";
        } else if (filePath.indexOf("/G.") > -1) {
          startNote = "G";
        } else if (filePath.indexOf("/Gs.") > -1) {
          startNote = "G#";
        } else if (filePath.indexOf("/A.") > -1) {
          startNote = "A";
        } else if (filePath.indexOf("/As.") > -1) {
          startNote = "A#";
        } else {
          startNote = "B";
        }

        
        var block1response = {
          type: "single-stim",
          stimuli: "<p>Were the two notes descending (going from high to low) or ascending (going from low to high)?</p>" +
            "<p>Press 1 for descending or 2 for ascending.</p>",
          is_html: true,
          choices: ["1", "2"],
          response_ends_trial: true,
          data: [{
            file: filePath,
            correct_key_press: correctKeyPress,
            startNote: startNote
          }],
          timing_post_trial: 500,
          on_finish: function (trialData) {
            var keyPress = trialData.key_press;
            var wasCorrect = (keyPress === trialData.correct_key_press);
            var currNoteC = (trialData.startNote === "C");
            var currNoteCs = (trialData.startNote === "C#");
            var currNoteD = (trialData.startNote === "D");
            var currNoteDs = (trialData.startNote === "D#");
            var currNoteE = (trialData.startNote === "E");
            var currNoteF = (trialData.startNote === "F");
            var currNoteFs = (trialData.startNote === "F#");
            var currNoteG = (trialData.startNote === "G");
            var currNoteGs = (trialData.startNote === "G#");
            var currNoteA = (trialData.startNote === "A");
            var currNoteAs = (trialData.startNote === "A#");
            var currNoteB = (trialData.startNote === "B");
            if (wasCorrect) {
              totalCorrect += 1;
            }
            if (wasCorrect && currNoteC) {
              totalCorrectC += 1;
            }
            if (wasCorrect && currNoteCs) {
              totalCorrectCs += 1;
            }
            if (wasCorrect && currNoteD) {
              totalCorrectD += 1;
            }
            if (wasCorrect && currNoteDs) {
              totalCorrectDs += 1;
            }
            if (wasCorrect && currNoteE) {
              totalCorrectE += 1;
            }
            if (wasCorrect && currNoteF) {
              totalCorrectF += 1;
            }
            if (wasCorrect && currNoteFs) {
              totalCorrectFs += 1;
            }
            if (wasCorrect && currNoteG) {
              totalCorrectG += 1;
            }
            if (wasCorrect && currNoteGs) {
              totalCorrectGs += 1;
            }
            if (wasCorrect && currNoteA) {
              totalCorrectA += 1;
            }
            if (wasCorrect && currNoteAs) {
              totalCorrectAs += 1;
            }
            if (wasCorrect && currNoteB) {
              totalCorrectB += 1;
            }
            jsPsych.data.addDataToLastTrial({
              was_correct: (wasCorrect ? 1 : 0),
              currNote_C: (currNoteC ? 1 : 0),
              currNote_Cs: (currNoteCs ? 1 : 0),
              currNote_D: (currNoteD ? 1 : 0),
              currNote_Ds: (currNoteDs ? 1 : 0),
              currNote_E: (currNoteE ? 1 : 0),
              currNote_F: (currNoteF ? 1 : 0),
              currNote_Fs: (currNoteFs ? 1 : 0),
              currNote_G: (currNoteG ? 1 : 0),
              currNote_Gs: (currNoteGs ? 1 : 0),
              currNote_A: (currNoteA ? 1 : 0),
              currNote_As: (currNoteAs ? 1 : 0),
              currNote_B: (currNoteB ? 1 : 0),              
              total_correct: totalCorrect,
              totalCorrect_C: totalCorrectC,
              totalCorrect_Cs: totalCorrectCs,
              totalCorrect_D: totalCorrectD,
              totalCorrect_Ds: totalCorrectDs,
              totalCorrect_E: totalCorrectE,
              totalCorrect_F: totalCorrectF,
              totalCorrect_Fs: totalCorrectFs,
              totalCorrect_G: totalCorrectG,
              totalCorrect_Gs: totalCorrectGs,
              totalCorrect_A: totalCorrectA,
              totalCorrect_As: totalCorrectAs,
              totalCorrect_B: totalCorrectB,
              total_By_Note: [totalCorrectC, totalCorrectCs, totalCorrectD, totalCorrectDs, totalCorrectE, totalCorrectF, totalCorrectFs, totalCorrectG, totalCorrectGs, totalCorrectA, totalCorrectAs, totalCorrectB]
            });

          }

        };
              experiment.push(block1trial);
              experiment.push(block1response);

      }

           /*Give listening instructions*/
      var listeningInstructions = {
        type: "text",
        text: "<p>You will now hear about 15 minutes of music in 3 sections.</p>" +
              "<p>Please enjoy and be ready to answer questions about your experience after each section.</p>" +
              "<p>Press any key to start the music.</p>",
        timing_post_trial: 0
      };
        
        experiment.push(listeningInstructions);
      
      
      
      /*Define which key*/
      
      var ambiguousKeys = [];
      var musicStim1 = [];
      var length1 = [];
      var musicStim2 = [];
      var length2 = [];
      var musicStim2 = [];
      var length2 = [];
      var musicStim3 = [];
      var length3 = [];
      
      var chooseKeys = {
        type: "single-stim",
        is_html: true,
        stimuli: "<p> </p>",
        timing_stim: 500,
        timing_response: 500,
        response_ends_trial: false,
        timing_post_trial: 0,
        on_finish: function (trialData) {
          
          var totalCorrectByNote = [totalCorrectC, totalCorrectCs, totalCorrectD, totalCorrectDs, totalCorrectE, totalCorrectF, totalCorrectFs, totalCorrectG, totalCorrectGs, totalCorrectA, totalCorrectAs, totalCorrectB];
          
          if (totalCorrectByNote.indexOf(2) > -1 || totalCorrectByNote.indexOf(3) > -1){
          
            if (totalCorrectC > 1 && totalCorrectC < 4){
            ambiguousKeys.push("C");
            }
            if (totalCorrectCs > 1 && totalCorrectCs < 4){
            ambiguousKeys.push("Cs");
            }
            if (totalCorrectD > 1 && totalCorrectD < 4){
            ambiguousKeys.push("D");
            }
            if (totalCorrectDs > 1 && totalCorrectDs < 4){
            ambiguousKeys.push("Ds");
            }
            if (totalCorrectE > 1 && totalCorrectE < 4){
            ambiguousKeys.push("E");
            }
            if (totalCorrectF > 1 && totalCorrectF < 4){
            ambiguousKeys.push("F");
            }
            if (totalCorrectFs > 1 && totalCorrectFs < 4){
            ambiguousKeys.push("Fs");
            }
            if (totalCorrectG > 1 && totalCorrectG < 4){
            ambiguousKeys.push("G");
            }
            if (totalCorrectGs > 1 && totalCorrectGs < 4){
            ambiguousKeys.push("Gs");
            }
            if (totalCorrectA > 1 && totalCorrectA < 4){
            ambiguousKeys.push("A");
            }
            if (totalCorrectAs > 1 && totalCorrectAs < 4){
            ambiguousKeys.push("As");
            }
            if (totalCorrectB > 1 && totalCorrectB < 4){
            ambiguousKeys.push("B");
            }
          var musicKey = jsPsych.randomization.sample(ambiguousKeys,1,false);
          }
          else if (totalCorrectByNote.indexOf(4) > -1){
          
            if (totalCorrectC > 3 && totalCorrectC < 5){
            ambiguousKeys.push("C");
            }
            if (totalCorrectCs > 3 && totalCorrectCs < 5){
            ambiguousKeys.push("Cs");
            }
            if (totalCorrectD > 3 && totalCorrectD < 5){
            ambiguousKeys.push("D");
            }
            if (totalCorrectDs > 3 && totalCorrectDs < 5){
            ambiguousKeys.push("Ds");
            }
            if (totalCorrectE > 3 && totalCorrectE < 5){
            ambiguousKeys.push("E");
            }
            if (totalCorrectF > 3 && totalCorrectF < 5){
            ambiguousKeys.push("F");
            }
            if (totalCorrectFs > 3 && totalCorrectFs < 5){
            ambiguousKeys.push("Fs");
            }
            if (totalCorrectG > 3 && totalCorrectG < 5){
            ambiguousKeys.push("G");
            }
            if (totalCorrectGs > 3 && totalCorrectGs < 5){
            ambiguousKeys.push("Gs");
            }
            if (totalCorrectA > 3 && totalCorrectA < 5){
            ambiguousKeys.push("A");
            }
            if (totalCorrectAs > 3 && totalCorrectAs < 5){
            ambiguousKeys.push("As");
            }
            if (totalCorrectB > 3 && totalCorrectB < 5){
            ambiguousKeys.push("B");
            }
          var musicKey = jsPsych.randomization.sample(ambiguousKeys,1,false);
          }
          else if (totalCorrectByNote.indexOf(1) > -1){
          
            if (totalCorrectC > 0 && totalCorrectC < 2){
            ambiguousKeys.push("C");
            }
            if (totalCorrectCs > 0 && totalCorrectCs < 2){
            ambiguousKeys.push("Cs");
            }
            if (totalCorrectD > 0 && totalCorrectD < 2){
            ambiguousKeys.push("D");
            }
            if (totalCorrectDs > 0 && totalCorrectDs < 2){
            ambiguousKeys.push("Ds");
            }
            if (totalCorrectE > 0 && totalCorrectE < 2){
            ambiguousKeys.push("E");
            }
            if (totalCorrectF > 0 && totalCorrectF < 2){
            ambiguousKeys.push("F");
            }
            if (totalCorrectFs > 0 && totalCorrectFs < 2){
            ambiguousKeys.push("Fs");
            }
            if (totalCorrectG > 0 && totalCorrectG < 2){
            ambiguousKeys.push("G");
            }
            if (totalCorrectGs > 0 && totalCorrectGs < 2){
            ambiguousKeys.push("Gs");
            }
            if (totalCorrectA > 0 && totalCorrectA < 2){
            ambiguousKeys.push("A");
            }
            if (totalCorrectAs > 0 && totalCorrectAs < 2){
            ambiguousKeys.push("As");
            }
            if (totalCorrectB > 0 && totalCorrectB < 2){
            ambiguousKeys.push("B");
            }
          var musicKey = jsPsych.randomization.sample(ambiguousKeys,1,false);
          }
          else if (totalCorrectByNote.indexOf(5) > -1){
          
            if (totalCorrectC > 4 && totalCorrectC < 6){
            ambiguousKeys.push("C");
            }
            if (totalCorrectCs > 4 && totalCorrectCs < 6){
            ambiguousKeys.push("Cs");
            }
            if (totalCorrectD > 4 && totalCorrectD < 6){
            ambiguousKeys.push("D");
            }
            if (totalCorrectDs > 4 && totalCorrectDs < 6){
            ambiguousKeys.push("Ds");
            }
            if (totalCorrectE > 4 && totalCorrectE < 6){
            ambiguousKeys.push("E");
            }
            if (totalCorrectF > 4 && totalCorrectF < 6){
            ambiguousKeys.push("F");
            }
            if (totalCorrectFs > 4 && totalCorrectFs < 6){
            ambiguousKeys.push("Fs");
            }
            if (totalCorrectG > 4 && totalCorrectG < 6){
            ambiguousKeys.push("G");
            }
            if (totalCorrectGs > 4 && totalCorrectGs < 6){
            ambiguousKeys.push("Gs");
            }
            if (totalCorrectA > 4 && totalCorrectA < 6){
            ambiguousKeys.push("A");
            }
            if (totalCorrectAs > 4 && totalCorrectAs < 6){
            ambiguousKeys.push("As");
            }
            if (totalCorrectB > 4 && totalCorrectB < 6){
            ambiguousKeys.push("B");
            }
          var musicKey = jsPsych.randomization.sample(ambiguousKeys,1,false);
          }
          else {musicKey = jsPsych.randomization.sample(["C","Cs","D","Ds","E","F","Fs","G","Gs","A","As","B"],1,false);}
          
          ambiguousKeys.push(musicKey);
          
          if(musicKey == "C"){
            musicStim1.push('music/C1.mp3');
            }
          else if(musicKey == "Cs"){
            musicStim1.push('music/Cs1.mp3');
            }
          else if(musicKey == "D"){
            musicStim1.push('music/D1.mp3');
            }
          else if(musicKey == "Ds"){
            musicStim1.push('music/Ds1.mp3');
            }          
          else if(musicKey == "E"){
            musicStim1.push('music/E1.mp3');
            }
          else if(musicKey == "F"){
            musicStim1.push('music/F1.mp3');
            }
          else if(musicKey == "Fs"){
            musicStim1.push('music/Fs1.mp3');
            }
          else if(musicKey == "G"){
            musicStim1.push('music/G1.mp3');
            }
          else if(musicKey == "Gs"){
            musicStim1.push('music/Gs1.mp3');
            }
          else if(musicKey == "A"){
            musicStim1.push('music/A1.mp3');
            }
          else if(musicKey == "As"){
            musicStim1.push('music/As1.mp3');
            }
          else if(musicKey == "B"){
            musicStim1.push('music/B1.mp3');
            }
          
          if(musicKey == "C"){
            length1.push(281000);
            }
          else if(musicKey == "Cs"){
            length1.push(314000);
            }
          else if(musicKey == "D"){
            length1.push(293000);
            }
          else if(musicKey == "Ds"){
            length1.push(259000);
            }
          else if(musicKey == "E"){
            length1.push(308000);
            }
          else if(musicKey == "F"){
            length1.push(287000);
            }
          else if(musicKey == "Fs"){
            length1.push(327000);
            }
          else if(musicKey == "G"){
            length1.push(316000);
            }
          else if(musicKey == "Gs"){
            length1.push(299000);
            }
          else if(musicKey == "A"){
            length1.push(310000);
            }
          else if(musicKey == "As"){
            length1.push(324000);
            }
          else if(musicKey == "B"){
            length1.push(308000);
            }
          
          if(musicKey == "C"){
            musicStim2.push('music/C2.mp3');
            }
          else if(musicKey == "Cs"){
            musicStim2.push('music/Cs2.mp3');
            }
          else if(musicKey == "D"){
            musicStim2.push('music/D2.mp3');
            }
          else if(musicKey == "Ds"){
            musicStim2.push('music/Ds2.mp3');
            }          
          else if(musicKey == "E"){
            musicStim2.push('music/E2.mp3');
            }
          else if(musicKey == "F"){
            musicStim2.push('music/F2.mp3');
            }
          else if(musicKey == "Fs"){
            musicStim2.push('music/Fs2.mp3');
            }
          else if(musicKey == "G"){
            musicStim2.push('music/G2.mp3');
            }
          else if(musicKey == "Gs"){
            musicStim2.push('music/Gs2.mp3');
            }
          else if(musicKey == "A"){
            musicStim2.push('music/A2.mp3');
            }
          else if(musicKey == "As"){
            musicStim2.push('music/As2.mp3');
            }
          else if(musicKey == "B"){
            musicStim2.push('music/B2.mp3');
            }
          
          if(musicKey == "C"){
            length2.push(205000);
            }
          else if(musicKey == "Cs"){
            length2.push(178000);
            }
          else if(musicKey == "D"){
            length2.push(187000);
            }
          else if(musicKey == "Ds"){
            length2.push(188000);
            }
          else if(musicKey == "E"){
            length2.push(180000);
            }
          else if(musicKey == "F"){
            length2.push(187000);
            }
          else if(musicKey == "Fs"){
            length2.push(180000);
            }
          else if(musicKey == "G"){
            length2.push(180000);
            }
          else if(musicKey == "Gs"){
            length2.push(194000);
            }
          else if(musicKey == "A"){
            length2.push(180000);
            }
          else if(musicKey == "As"){
            length2.push(171000);
            }
          else if(musicKey == "B"){
            length2.push(171000);
            }          
          
          if(musicKey == "C"){
            musicStim3.push('music/C3.mp3');
            }
          else if(musicKey == "Cs"){
            musicStim3.push('music/Cs3.mp3');
            }
          else if(musicKey == "D"){
            musicStim3.push('music/D3.mp3');
            }
          else if(musicKey == "Ds"){
            musicStim3.push('music/Ds3.mp3');
            }          
          else if(musicKey == "E"){
            musicStim3.push('music/E3.mp3');
            }
          else if(musicKey == "F"){
            musicStim3.push('music/F3.mp3');
            }
          else if(musicKey == "Fs"){
            musicStim3.push('music/Fs3.mp3');
            }
          else if(musicKey == "G"){
            musicStim3.push('music/G3.mp3');
            }
          else if(musicKey == "Gs"){
            musicStim3.push('music/Gs3.mp3');
            }
          else if(musicKey == "A"){
            musicStim3.push('music/A3.mp3');
            }
          else if(musicKey == "As"){
            musicStim3.push('music/As3.mp3');
            }
          else if(musicKey == "B"){
            musicStim3.push('music/B3.mp3');
            }
          
          if(musicKey == "C"){
            length3.push(416000);
            }
          else if(musicKey == "Cs"){
            length3.push(409000);
            }
          else if(musicKey == "D"){
            length3.push(420000);
            }
          else if(musicKey == "Ds"){
            length3.push(449000);
            }
          else if(musicKey == "E"){
            length3.push(413000);
            }
          else if(musicKey == "F"){
            length3.push(427000);
            }
          else if(musicKey == "Fs"){
            length3.push(398000);
            }
          else if(musicKey == "G"){
            length3.push(405000);
            }
          else if(musicKey == "Gs"){
            length3.push(396000);
            }
          else if(musicKey == "A"){
            length3.push(413000);
            }
          else if(musicKey == "As"){
            length3.push(407000);
            }
          else if(musicKey == "B"){
            length3.push(422000);
            }
            
          jsPsych.data.addDataToLastTrial({
            ambiguous_Keys: ambiguousKeys,
            music_Key: musicKey,
            music_Stim1: musicStim1,
            length_1: length1,
            music_Stim2: musicStim2,
            length_2: length2,
            music_Stim3: musicStim3,
            length_3: length3
            
          });
        }
      };
      
      experiment.push(chooseKeys);

      
   /*Stream the music for them*/
   
   
      var musicBlock1 = {
        type: "single-stim",
        stimuli: function () {
          return ['<audio id="blah" autoplay="true" src="' + musicStim1 + '">'];
        },
        prompt: "Music section 1:  Please listen and enjoy! There may be a few seconds of delay before and after the music ends, so please be patient.",
        timing_stim: function () {
          return length1;
        },
        timing_response: function () {
          return length1;
        },
        is_html: true,
        response_ends_trial: false,
        timing_post_trial: 0
      }; 
      
      experiment.push(musicBlock1);
      
      var question1 = {
         type: "text",
         text: "<p>On a scale of 1-5 (least to greatest) how soothing did you find the music?</p>" +
               "<p>Choose a number key (1, 2, 3, 4, or 5) to answer.</p>",
         choices: ["1", "2", "3", "4", "5"],
         response_ends_trial: true,
         timing_post_trial: 2000
      };
      experiment.push(question1);
      
      var musicBlock2 = {
        type: "single-stim",
        stimuli: function () {
          return ['<audio id="blah" autoplay="true" src="' + musicStim2 + '">'];
        },
        prompt:  "Music section 2:  Please listen and enjoy! There may be a few seconds of delay before and after the music ends, so please be patient.",
        timing_stim: function () {
          return length2;
        },
        timing_response: function () {
          return length2;
        },
        is_html: true,
        response_ends_trial: false,
        timing_post_trial: 0
      };
      experiment.push(musicBlock2);

      
      var question2 = {
         type: "text",
         text: "<p>On a scale of 1-5 (least to greatest) how catchy did you find the music?</p>" +
               "<p>Choose a number key (1, 2, 3, 4, or 5) to answer.</p>",
         choices: ["1", "2", "3", "4", "5"],
         response_ends_trial: true,
         timing_post_trial: 2000
      };
      experiment.push(question2);
      
      var musicBlock3 = {
        type: "single-stim",
        stimuli: function () {
          return ['<audio id="blah" autoplay="true" src="' + musicStim3 + '">'];
        },
        prompt:  "Music section 3:  Please listen and enjoy! There may be a few seconds of delay before and after the music ends, so please be patient.",
        timing_stim: function () {
          return length3;
        },
        timing_response: function () {
          return length3;
        },
        is_html: true,
        response_ends_trial: false,
        timing_post_trial: 0
      }; 
      experiment.push(musicBlock3);
      
      var question3 = {
         type: "text",
         text: "<p>On a scale of 1-5 (least to greatest) how likely would you be to listen to this type of music outside of this experiment?</p>" +
               "<p>Choose a number key (1, 2, 3, 4, or 5) to answer.</p>",
         choices: ["1", "2", "3", "4", "5"],
         response_ends_trial: true,
         timing_post_trial: 2000
      };
      experiment.push(question3);
      
      
      
      
      var block2inst = {
        type: "text",
        text: "<p>You will now repeat the task from the first portion of the experiment.</p>" +
              "<p>Press any key to start.</p>",
        timing_post_trial: 2000
      };
        
        experiment.push(block2inst);

      for (var i = 0; i < blocklength; i += 1) {
        var stimulus2 = block2Stimuli[i];
        var startNote2;

        var block2trial = {
          type: "single-audio",
          stimuli: [stimulus2],
          timing_response: 1150,
          response_ends_trial: false,
          timing_post_trial: 0
        };
        
        var filePath2 = decodeURIComponent(stimulus2);
        var correctKeypress2 = 49;
        if (filePath2.indexOf("/C.") > -1) {
          startNote2 = "C";
        } else if (filePath2.indexOf("/Cs.") > -1) {
          startNote2 = "C#";
        } else if (filePath2.indexOf("/D.") > -1) {
          startNote2 = "D";
        } else if (filePath2.indexOf("/Ds.") > -1) {
          startNote2 = "D#";
        } else if (filePath2.indexOf("/E.") > -1) {
          startNote2 = "E";
        } else if (filePath2.indexOf("/F.") > -1) {
          startNote2 = "F";
        } else if (filePath2.indexOf("/Fs.") > -1) {
          startNote2 = "F#";
        } else if (filePath2.indexOf("/G.") > -1) {
          startNote2 = "G";
        } else if (filePath2.indexOf("/Gs.") > -1) {
          startNote2 = "G#";
        } else if (filePath2.indexOf("/A.") > -1) {
          startNote2 = "A";
        } else if (filePath2.indexOf("/As.") > -1) {
          startNote2 = "A#";
        } else {
          startNote2 = "B";
        }

        
        var block2response = {
          type: "single-stim",
          stimuli: "<p>Were the two notes descending (going from high to low) or ascending (going from low to high)?</p>" +
            "<p>press 1 for descending or 2 for ascending.</p>",
          is_html: true,
          choices: ["1", "2"],
          response_ends_trial: true,
          data: [{
            file: filePath2,
            correct_key_press2: correctKeypress2,
            startNote2: startNote2
          }],
          timing_post_trial: 500,
          on_finish: function (trialData) {
            var keypress2 = trialData.key_press;
            var wasCorrect2 = (keypress2 === trialData.correct_key_press2);
            var currNoteC2 = (trialData.startNote2 === "C");
            var currNoteCs2 = (trialData.startNote2 === "C#");
            var currNoteD2 = (trialData.startNote2 === "D");
            var currNoteDs2 = (trialData.startNote2 === "D#");
            var currNoteE2 = (trialData.startNote2 === "E");
            var currNoteF2 = (trialData.startNote2 === "F");
            var currNoteFs2 = (trialData.startNote2 === "F#");
            var currNoteG2 = (trialData.startNote2 === "G");
            var currNoteGs2 = (trialData.startNote2 === "G#");
            var currNoteA2 = (trialData.startNote2 === "A");
            var currNoteAs2 = (trialData.startNote2 === "A#");
            var currNoteB2 = (trialData.startNote2 === "B");
            if (wasCorrect2) {
              totalCorrect2 += 1;
            }
            if (wasCorrect2 && currNoteC2) {
              totalCorrectC2 += 1;
            }
            if (wasCorrect2 && currNoteCs2) {
              totalCorrectCs2 += 1;
            }
            if (wasCorrect2 && currNoteD2) {
              totalCorrectD2 += 1;
            }
            if (wasCorrect2 && currNoteDs2) {
              totalCorrectDs2 += 1;
            }
            if (wasCorrect2 && currNoteE2) {
              totalCorrectE2 += 1;
            }
            if (wasCorrect2 && currNoteF2) {
              totalCorrectF2 += 1;
            }
            if (wasCorrect2 && currNoteFs2) {
              totalCorrectFs2 += 1;
            }
            if (wasCorrect2 && currNoteG2) {
              totalCorrectG2 += 1;
            }
            if (wasCorrect2 && currNoteGs2) {
              totalCorrectGs2 += 1;
            }
            if (wasCorrect2 && currNoteA2) {
              totalCorrectA2 += 1;
            }
            if (wasCorrect2 && currNoteAs2) {
              totalCorrectAs2 += 1;
            }
            if (wasCorrect2 && currNoteB2) {
              totalCorrectB2 += 1;
            }
            jsPsych.data.addDataToLastTrial({
              was_correct2: (wasCorrect2 ? 1 : 0),
              currNote_C2: (currNoteC2 ? 1 : 0),
              currNote_Cs2: (currNoteCs2 ? 1 : 0),
              currNote_D2: (currNoteD2 ? 1 : 0),
              currNote_Ds2: (currNoteDs2 ? 1 : 0),
              currNote_E2: (currNoteE2 ? 1 : 0),
              currNote_F2: (currNoteF2 ? 1 : 0),
              currNote_Fs2: (currNoteFs2 ? 1 : 0),
              currNote_G2: (currNoteG2 ? 1 : 0),
              currNote_Gs2: (currNoteGs2 ? 1 : 0),
              currNote_A2: (currNoteA2 ? 1 : 0),
              currNote_As2: (currNoteAs2 ? 1 : 0),
              currNote_B2: (currNoteB2 ? 1 : 0),              
              total_correct2: totalCorrect2,
              totalCorrect_C2: totalCorrectC2,
              totalCorrect_Cs2: totalCorrectCs2,
              totalCorrect_D2: totalCorrectD2,
              totalCorrect_Ds2: totalCorrectDs2,
              totalCorrect_E2: totalCorrectE2,
              totalCorrect_F2: totalCorrectF2,
              totalCorrect_Fs2: totalCorrectFs2,
              totalCorrect_G2: totalCorrectG2,
              totalCorrect_Gs2: totalCorrectGs2,
              totalCorrect_A2: totalCorrectA2,
              totalCorrect_As2: totalCorrectAs2,
              totalCorrect_B2: totalCorrectB2,
              total_By_Note2: [totalCorrectC2, totalCorrectCs2, totalCorrectD2, totalCorrectDs2, totalCorrectE2, totalCorrectF2, totalCorrectFs2, totalCorrectG2, totalCorrectGs2, totalCorrectA2, totalCorrectAs2, totalCorrectB2]
            });

          }

        };
              experiment.push(block2trial);
              experiment.push(block2response);

      }        
        

      var questionnaire = {
        type: "survey-text",
        preamble: ['The following is a questionnaire to gauge your musical experience as well as some basic demographic information.'],
        questions: [[
        'What is your gender? (Please type "M", "F", or "prefer not to answer")',
        'What is your age?',
        'Have you heard any of the music used in this study before?',
		'How many sections of music did you listen to in this experiment?',
        'What would you consider your primary instrument? If you do not have any musical training, you may leave this question blank.',
        'At what age did you first begin musical instruction? If you do not have any musical training, you may leave this question blank.',
        'How many years total have you played/did you play a musical instrument? If you do not have any musical training, please type "0".',
        'Do you have absolute pitch? (Absolute pitch is the ability to name or produce any musical note "out of thin air.")'
        ]],
        on_finish: function () {
          var csvData = jsPsych.data.dataAsCSV();
          console.log(csvData);
          var formData = {
            exp: "TRITONE_1",  // comment out for testing
            // exp: "TEST",  // uncomment for testing
            subj: subjectID,
            results: csvData
          };
          $.post(
            "http://perfectpitchstudies.pythonanywhere.com/data",
            formData
          );
          $.post(
            "http://svanhedger.pythonanywhere.com/data",
            formData
          );
        }
      };
      
      experiment.push(questionnaire);
      
      var goodbye = {
        type: "single-stim",
        stimuli: function () {
          var pageText = '<p>This concludes the experiment. Thank you for your participation.</p>' +
                         '<p>Below is your subject ID. Please copy it.</p>' +
                         '<p>' + subjectID + '</p>';
          return [pageText];
        },
        is_html: true,
        response_ends_trial: false,
        timing_post_trial: 0
      };
      
      experiment.push(goodbye);

      
      jsPsych.init({
        experiment_structure: experiment
      });
    </script>
  </body>
</html>